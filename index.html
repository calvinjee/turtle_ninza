<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      canvas {
        display: flex;
        border: 1px solid black;
        margin: auto;
        background-image: url('./assets/images/bg-2.png');
        background-size: contain;
        background-repeat: round;
      }
    </style>
    <script type="text/javascript">

    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      // let background = new Image();
      // background.src = './assets/images/bg-2.png';
      // background.onload = () => {
      //   ctx.drawImage(background, 0, 0)
      // }

      window.setInterval(() => {
        raf.tickCount += 1
        // if (raf.moveBools) {
        //   raf.draw(raf.direction)
        // }
        if (Object.values(raf.moveBools).some((bool) => bool === true )) {
          raf.draw(raf.direction)
        }
      })

      class PlayerSprite {
        constructor(options) {
          this.context = options.context;
          this.width = options.width;
          this.height = options.height;
          this.dx = this.context.canvas.width / 2;
          this.dy = this.context.canvas.height - 100;
          this.image = options.image;
          this.frameIndex = 0;
          this.tickCount = 0;
          this.ticksPerFrame = 60;
          this.numberOfFrames = options.numberOfFrames || 1;
          this.moveBools = {
            left: false,
            right: false,
            up: false,
            down: false
          };
          this.direction = "idle";
        }

        draw(direction) {
          this.context.clearRect(this.dx, this.dy, this.width / this.numberOfFrames, this.height);

          let dir;
          switch(direction) {
            case 'left': // left
              dir = -1;
              break;
            case 'right': // right
              dir = 1;
              break;
          }

          this.tickCount += 1;

          if (this.tickCount > this.ticksPerFrame) {
            this.frameIndex = (this.frameIndex + 1) % this.numberOfFrames
            this.tickCount = 0
          }

          this.dx += dir

          this.context.drawImage(
            this.image,
            this.frameIndex * this.width / this.numberOfFrames, // source x
            110, // source y
            this.width / this.numberOfFrames, // source width
            this.height, // source height
            this.dx, // destination x
            this.dy, // destination y
            this.width / this.numberOfFrames, // destination width
            this.height // destination height
          )

        }

        render() {
          this.image.onload = () => {
            this.context.drawImage(
              this.image,
              this.frameIndex * (this.width / this.numberOfFrames), // source x
              110, // source y
              this.width / this.numberOfFrames, // source width
              this.height, // source height
              this.dx, // destination x
              this.dy, // destination y
              this.width / this.numberOfFrames, // destination width
              this.height // destination height
            )
          }
        }
      }

      const playerRaf = new Image();
      playerRaf.src = './assets/images/raf_sprite.gif';

      const rafOptions = {
        context: ctx,
        width: 350,
        height: 95,
        image: playerRaf,
        numberOfFrames: 5,
      };

      const raf = new PlayerSprite(rafOptions);

      raf.render();

      document.addEventListener('keydown', (e) => {
        // console.log(e.keyCode);
        switch(e.keyCode) {
          case 37: // left
            raf.direction = 'left';
            raf.moveBools.left = true;
            break;
          case 39: // right
            raf.direction = 'right';
            raf.moveBools.right = true;
            break;
          case 32: // space

        }
        // raf.draw(e.keyCode)
        }
      )

      document.addEventListener('keyup', (e) => {
        console.log(e.keyCode)
        switch(e.keyCode) {
          case 37: // left

            raf.moveBools.left = false;
            break;
          case 39: // right

            raf.moveBools.right = false;
            break;
          case 32: // space

        }

        }
      )

    })

    </script>
  </head>
  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
  </body>
</html>
