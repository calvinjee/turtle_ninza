<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      canvas {
        display: flex;
        border: 1px solid black;
        margin: auto;
        background-image: url('./assets/images/bg-2.png');
        background-size: contain;
        background-repeat: round;
      }
    </style>
    <script type="text/javascript">

    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      // let background = new Image();
      // background.src = './assets/images/bg-2.png';
      // background.onload = () => {
      //   ctx.drawImage(background, 0, 0)
      // }

      class Entity {
        constructor(options) {
          this.context = options.context;
          this.image = options.image;
          this.sX = options.sX;
          this.sY = options.sY;
          this.sWidth = options.sWidth;
          this.sHeight = options.sHeight;
          this.dX = options.dX;
          this.dY = options.dY;
          this.dWidth = options.dWidth;
          this.dHeight = options.dHeight;
        }

        draw() {
          this.context.drawImage(
            this.image,
            this.sX, // source x
            this.sY, // source y
            this.sWidth, // source width
            this.sHeight, // source height
            this.dX, // destination x
            this.dY, // destination y
            this.dWidth, // destination width
            this.dHeight // destination height
          );
        }

        render() {
          this.image.onload = () => {
            this.draw();

          };
        }
      }

      class Player extends Entity {
        constructor(options) {
          super(options);
          this.moveBools = {
            left: false,
            right: false,
            // up: false,
            // down: false
          };
          this.direction = "idle";

          this.frameIndex = 0;
          this.tickCount = 0;
          this.ticksPerFrame = 60;
          this.movement = options.movement;
        }

        move(direction) {

          if (Object.values(this.moveBools).some((bool) => bool === true )) {
            this.tickCount += 2;
            this.context.clearRect(this.dX, this.dY, this.sWidth, this.sHeight);

            this.sX = this.frameIndex * (this.movement.width / this.movement.numberOfFrames);
            this.sY = this.movement.y;
            this.sWidth = this.movement.width / this.movement.numberOfFrames;
            this.sHeight = this.movement.height;

            let dir;
            switch(direction) {
              case 'left': // left
                dir = -1;
                break;
              case 'right': // right
                dir = 1;
                break;
            }

            this.dX += dir;
            this.dWidth = this.sWidth;
            this.dHeight = this.sHeight;

            if (this.tickCount > this.ticksPerFrame) {
              this.frameIndex = (this.frameIndex + 1) % this.movement.numberOfFrames;
              this.tickCount = 0;
            }

            this.draw();
          }
        }
      }

      const playerRaf = new Image();
      playerRaf.src = './assets/images/raf_sprite.gif';

      const rafOptions = {
        context: ctx,
        image: playerRaf,
        sX: 0,
        sY: 110,
        sWidth: 350 / 5,
        // sWidth: 400,
        // sHeight: 400,
        sHeight: 95,
        dX: ctx.canvas.width / 2,
        dY: ctx.canvas.height - 100,
        dWidth: 350 / 5,
        dHeight: 95,
        movement: {
          x: 0,
          y: 110,
          width: 350,
          height: 95,
          numberOfFrames: 5,
        }
      };

      const raf = new Player(rafOptions);

      raf.render();

      document.addEventListener('keydown', (e) => {
        // console.log(e.keyCode);
        switch(e.keyCode) {
          case 37: // left
            raf.direction = 'left';
            raf.moveBools.left = true;
            break;
          case 39: // right
            raf.direction = 'right';
            raf.moveBools.right = true;
            break;
          case 32: // space
            // raf.shoot();
            // break;
        }

      });

      document.addEventListener('keyup', (e) => {
        switch(e.keyCode) {
          case 37: // left

            raf.moveBools.left = false;
            break;
          case 39: // right

            raf.moveBools.right = false;
            break;
          case 32: // space
            // raf.shoot();
        }
      });


      window.setInterval(() => {

        raf.move(raf.direction);
      });

    });



    </script>
  </head>
  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
  </body>
</html>
